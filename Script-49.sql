




select `name` 'id', date_format(creation, '%Y-%m-%d') 'date_created', date_format(modified, '%Y-%m-%d') 'date_updated',
	concat(staff_no, ' - ', staff_name) 'sales_person', broker_name , broker_tel , facebook , broker_workplace , business_type , `year` 
	address_province , address_district , address_village , ever_introduced , contract_no , `rank` , 
	date_will_contract , customer_name , customer_tel , currency , amount , collateral , remark 
from tabfive_relationships 


select * from tabfive_relationships order by name desc limit 10;
select * from five_relationships_id_seq;


-- add datetime
SELECT ADDTIME("10:54:21", "00:10:00") as Updated_time ;
SELECT ADDTIME("2023-08-01 12:55:45.212689000", "02:00:00") as Updated_time ;
-- deduct datetime
SELECT SUBTIME('06:14:03', '15:50:90') AS Result;
SELECT SUBTIME('2019-05-01 11:15:45', '20 04:02:01') AS Result; 

select date_format('2023-08-02', '%c'); -- Numeric month name (0 to 12) https://www.w3schools.com/sql/func_mysql_date_format.asp
select date_format('2023-08-02', '%e'); -- Day of the month as a numeric value (0 to 31) https://www.w3schools.com/sql/func_mysql_date_format.asp

select * from tabSME_BO_and_Plan tsbap order by name desc; -- 51554
select * from tabSME_BO_and_Plan tsbap where staff_no = '577' ;
select * from tabUser tu ;
select * from sme_org so ;



select * from tabsme_Sales_partner where owner_staff is null;


-- check and update the data for each rank
select name, rank1 , rank_update , rank_S_date , rank_A_date , rank_B_date , rank_C_date from tabSME_BO_and_Plan where rank_update in ('S','A','B','C');


-- update rank, own_salesperson, customer_tel
update tabSME_BO_and_Plan 
	set rank_S_date = case when rank_update = 'S' then date_format(modified, '%Y-%m-%d') else rank_S_date end,
	rank_A_date = case when rank_update = 'A' then date_format(modified, '%Y-%m-%d') else rank_A_date end,
	rank_B_date = case when rank_update = 'B' then date_format(modified, '%Y-%m-%d') else rank_B_date end,
	rank_C_date = case when rank_update = 'C' then date_format(modified, '%Y-%m-%d') else rank_C_date end,
	rank_update = case when contract_status = 'Contracted' then 'S' else rank_update end,
	ringi_status = case when contract_status = 'Contracted' then 'Approved' else ringi_status end,
	visit_or_not = case when contract_status = 'Contracted' then 'Yes - ຢ້ຽມຢາມແລ້ວ' when visit_date > date(now()) and visit_or_not = 'Yes - ຢ້ຽມຢາມແລ້ວ' then 'No - ຍັງບໍ່ໄດ້ລົງຢ້ຽມຢາມ' else visit_or_not end,
	rank1 = case when date_format(creation, '%Y-%m-%d') = date_format(modified, '%Y-%m-%d') then rank_update else rank1 end,
	`own_salesperson` = case when `own_salesperson` is not null then `own_salesperson` when callcenter_of_sales is null or callcenter_of_sales = '' then staff_no else regexp_replace(callcenter_of_sales  , '[^[:digit:]]', '') end,
	customer_tel = 
	case when customer_tel = '' then ''
		when (length (regexp_replace(customer_tel , '[^[:digit:]]', '')) = 11 and left (regexp_replace(customer_tel , '[^[:digit:]]', ''),3) = '020')
			or (length (regexp_replace(customer_tel , '[^[:digit:]]', '')) = 10 and left (regexp_replace(customer_tel , '[^[:digit:]]', ''),2) = '20')
			or (length (regexp_replace(customer_tel , '[^[:digit:]]', '')) = 8 and left (regexp_replace(customer_tel , '[^[:digit:]]', ''),1) in ('2','5','7','8','9'))
		then concat('9020',right(regexp_replace(customer_tel , '[^[:digit:]]', ''),8)) -- for 020
		when (length (regexp_replace(customer_tel , '[^[:digit:]]', '')) = 10 and left (regexp_replace(customer_tel , '[^[:digit:]]', ''),3) = '030')
			or (length (regexp_replace(customer_tel , '[^[:digit:]]', '')) = 9 and left (regexp_replace(customer_tel , '[^[:digit:]]', ''),2) = '30')
			or (length (regexp_replace(customer_tel , '[^[:digit:]]', '')) = 7 and left (regexp_replace(customer_tel , '[^[:digit:]]', ''),1) in ('2','4','5','7','9'))
		then concat('9030',right(regexp_replace(customer_tel , '[^[:digit:]]', ''),7)) -- for 030
		when left (right (regexp_replace(customer_tel , '[^[:digit:]]', ''),8),1) in ('0','1','') then concat('9030',right(regexp_replace(customer_tel , '[^[:digit:]]', ''),7))
		when left (right (regexp_replace(customer_tel , '[^[:digit:]]', ''),8),1) in ('2','5','7','8','9')
		then concat('9020',right(regexp_replace(customer_tel , '[^[:digit:]]', ''),8))
		else concat('9020',right(regexp_replace(customer_tel , '[^[:digit:]]', ''),8))
	end
;

 
update tabsme_Sales_partner
	set broker_tel = 
	  case when broker_tel = '' then ''
		when (length (regexp_replace(broker_tel , '[^[:digit:]]', '')) = 11 and left (regexp_replace(broker_tel , '[^[:digit:]]', ''),3) = '020')
			or (length (regexp_replace(broker_tel , '[^[:digit:]]', '')) = 10 and left (regexp_replace(broker_tel , '[^[:digit:]]', ''),2) = '20')
			or (length (regexp_replace(broker_tel , '[^[:digit:]]', '')) = 8 and left (regexp_replace(broker_tel , '[^[:digit:]]', ''),1) in ('2','5','7','8','9'))
		then concat('9020',right(regexp_replace(broker_tel , '[^[:digit:]]', ''),8)) -- for 020
		when (length (regexp_replace(broker_tel , '[^[:digit:]]', '')) = 10 and left (regexp_replace(broker_tel , '[^[:digit:]]', ''),3) = '030')
			or (length (regexp_replace(broker_tel , '[^[:digit:]]', '')) = 9 and left (regexp_replace(broker_tel , '[^[:digit:]]', ''),2) = '30')
			or (length (regexp_replace(broker_tel , '[^[:digit:]]', '')) = 7 and left (regexp_replace(broker_tel , '[^[:digit:]]', ''),1) in ('2','4','5','7','9'))
		then concat('9030',right(regexp_replace(broker_tel , '[^[:digit:]]', ''),7)) -- for 030
		when left (right (regexp_replace(broker_tel , '[^[:digit:]]', ''),8),1) in ('0','1','') then concat('9030',right(regexp_replace(broker_tel , '[^[:digit:]]', ''),7))
		when left (right (regexp_replace(broker_tel , '[^[:digit:]]', ''),8),1) in ('2','5','7','8','9')
		then concat('9020',right(regexp_replace(broker_tel , '[^[:digit:]]', ''),8))
		else concat('9020',right(regexp_replace(broker_tel , '[^[:digit:]]', ''),8))
	end,
	broker_type = case when refer_type = 'LMS_Broker' then 'SP - ນາຍໜ້າໃນອາດີດ' else broker_type end,
	refer_type = case when broker_type = '5way - 5ສາຍພົວພັນ' and refer_type is null then '5way' else refer_type end
;




-- update backup data 
insert into tabSME_BO_and_Plan select * from tabSME_BO_and_Plan_bk where name not in (select name from tabSME_BO_and_Plan);
replace into tabSME_BO_and_Plan_bk select * from tabSME_BO_and_Plan; -- Updated Rows	495867
-- replace into tabsme_Sales_partner_bk select * from tabsme_Sales_partner; -- Updated Rows	151647




-- BO https://docs.google.com/spreadsheets/d/1rKhGY4JN5N0EZs8WiUC8dVxFAiwGrxcMp8-K_Scwlg4/edit#gid=1793628529&fvid=551853106
replace into SME_BO_and_Plan_report 
select case when bpr.date_report is null then date(now()) else bpr.date_report end `date_report`, sme.staff_no, 1 `case`, case when bp.`type` = 'New' then 'NEW' when bp.`type` = 'Dor' then 'DOR' when bp.`type` = 'Inc' then 'INC' end `type`,
	bp.usd_loan_amount, bp.case_no, bp.contract_no, -- bp.customer_name, 
	concat('=HYPERLINK("http://13.250.153.252:8000/app/sme_bo_and_plan/"&',bp.name,',', '"' , bp.customer_name, '"',')' ) `customer_name`,
	bp.rank_update,
	case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' 
		when bp.ringi_status = 'Approved' then 'APPROVED' when bp.ringi_status = 'Pending approval' then 'PENDING' 
		when bp.ringi_status = 'Draft' then 'DRAFT' when bp.ringi_status = 'Not Ringi' then 'No Ringi' 
	end `now_result`, 
	bp.disbursement_date_pay_date , 
	case when bpr.id is null and (bp.disbursement_date_pay_date is null or bp.disbursement_date_pay_date < date(now())) then null 
		when bp.disbursement_date_pay_date >= date(Now()) then 'ແຜນເພີ່ມ' when bpr.which is null then null
		when bpr.id is not null then 'ແຜນເພີ່ມ' else bpr.which
	end `which`, 
	bp.name `id`, case when bp.credit_remark is not null then bp.credit_remark else bp.contract_comment end `comments`
from tabSME_BO_and_Plan bp left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
left join SME_BO_and_Plan_report bpr on (bpr.id = bp.name)
where ((bp.rank_update in ('S','A','B','C') /*or bp.list_type is not null*/ )
	and case when bp.contract_status = 'Contracted' and bp.disbursement_date_pay_date < '2024-08-01' then 0 else 1 end != 0 -- if contracted before '2023-09-29' then not need
	-- and bp.disbursement_date_pay_date between date(now()) and '2024-07-31' -- and date_format(bp.modified, '%Y-%m-%d') >= date(now())
	-- and bp.ringi_status != 'Rejected' -- and bp.contract_status != 'Cancelled'
	) or bp.name in (select id from SME_BO_and_Plan_report)
order by sme.id ;

select * from SME_BO_and_Plan_report bpr -- where date_report = '2024-06-21';


-- _________________ delete in the last month sales plan but can't execute _________________
-- delete from SME_BO_and_Plan_report where now_result in ('Contracted', 'Cancelled') ;
-- delete from SME_BO_and_Plan_report where disbursement_date_pay_date < '2024-07-01' or disbursement_date_pay_date is null;
-- delete from SME_BO_and_Plan_report where id = 638551;

update SME_BO_and_Plan_report set which = null where now_result != 'Contracted' and disbursement_date_pay_date is null

select bpr.* , case when bp.modified >= date(now()) then 'called' else 0 end `is_call_today`, sme.id 
from SME_BO_and_Plan_report bpr left join tabSME_BO_and_Plan bp on (bpr.id = bp.name)
left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
where bpr.which = 'ແຜນເພີ່ມ' and bpr.staff_no is not null -- and bpr.now_result = 'Contracted' and bpr.disbursement_date_pay_date is null
order by sme.id asc ;


-- auto sync to google sheet https://docs.google.com/spreadsheets/d/1Te5-HcXAG8p8nDBrHFiZyEcqPzP4Qqf4OBqA1YloRRg/edit?gid=1913257518#gid=1913257518
select sme.id, sme.`g-dept`, sme.dept, sme.sec_branch, sme.unit_no, sme.unit, sme.mini_unit, sme.staff_name,
	bpr.staff_no, bpr.case, bpr.`type`, bpr.usd_loan_amount, bpr.case_no, bpr.contract_no, bpr.customer_name, bpr.rank_update, bpr.now_result, 
	bpr.disbursement_date_pay_date, bpr.which, bpr.id, bpr.comments, 
	case when bp.modified >= date(now()) then 'called' else 0 end `is_call_today`,
	bpr.date_report, bp.customer_name,
	case when bpr.now_result = 'Contracted' and bpr.disbursement_date_pay_date = date(now()) then 'Daily report' 
from SME_BO_and_Plan_report bpr left join tabSME_BO_and_Plan bp on (bpr.id = bp.name)
left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
where bpr.which = 'ແຜນເພີ່ມ' and bpr.staff_no is not null -- and bpr.now_result = 'Contracted' and bpr.disbursement_date_pay_date is null
order by sme.id asc ;


-- manual 
select bpr.* , case when bp.modified >= date(now()) then 'called' else 0 end `is_call_today`, sme.id 
from SME_BO_and_Plan_report bpr left join tabSME_BO_and_Plan bp on (bpr.id = bp.name)
left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
where bpr.id in (674721,711004,665983,706525,688488,665905,704979,686499,662605,699087,681894,660232,676963,208570,666056,708292,666619,684816,694563,669877,703300,707168,666109,683008,702421,706520,665290,668932,676796,673173,692623,701652,706313,664082,668331,672884,689592,710517,700152,704685,662719,667507,671520,688245,709510,698424,704243,708195,709719,707174,704985,683810,666128,698833,668939,670664,710960,704848,682501,665884,692982,694894,668921,670117,710121,702922,708688,680540,691124,667327,702424,706723,676857,690327,666554,701548,674280,706294,688270,666548,699128,671597,704980,699393,667023,670310,694320,666551,666288,659531,694011,706757,657189,667513,685778,704981,656494,704883,664688,700425,659691,706031,682730,697281,657744,668991,705599,677860,695285,622633,668686,704500,708899,670010,667087,701709,661782,706508,666442,701297,661231,706045,685960,710188,706340,681686,661228,668187,699055,705053,677463,711078,667387,695774,705015,673874,710186,689330,667051,668556,702439,671564,709901,683674,708098,667043,668552,701637,669613,709095,707051,682453,664765,668188,700028,708943,707601,677667,677294,705017,700038,710009,670449,667012,711103,683283,701712,706121,692363,666552,710781,680910,668975,705052,689977,700369,664818,709244,677509,668676,704924,688235,698973,709086,674619,668160,704004,687353,697250,702608,708100,671750,667552,686089,695719,702429,706783,694012,666557,679868,708931,692046,701211,664012,711168,682130,704501,666504,682056,699089,666503,682039,666119,707275,660531,668178,705597,667089,667040,692151,666059,682973,681359,661226,705041,670809,693835,5798,668663,670808,704061,691292,667955,702438,684964,666870,666044,708912,710002,673872,664210,707563,671589,683014,690343,698180,689916,695074,688634,695049,709301,688314,706227,686648,691396,704970,680809,677733,699755,655302,666062,691440,708059,667898,674269,698288,690223,706457,666005,667594,674231,697242,688361,704976,665910,667254,670515,694851,686070,701431,662277,667061,668605,681211,699770,657684,667000,692105,668171,702251,666939,703364,678087,710024,689545,666432,702441,668849,708099,708994,673957,685891,664153,701660,668354,699990,706996,671747,683247,660963,667799,694692,705748,669558,681472,667280,704802,678109,661100,697016,666818,705971,666049,704964,664029,698857,675047,645714,667379,706266,632156,667058,662751,705291,666959,662313,664800,651284,651138,668888,709849,668181,669052,665019,681401,694790,668341,706464,662860,702513,683054,701645,709060,698508,35759,701571,676405,672408,668784,705458,680413,692847,666987,706938,685718,665433,705047,670208,668660,663032,697034,671523,693850,667607,695060,709943,691294,666361,709031,687880,662168,677640,659538,673237,698370,673682,656265,710868,668767,705051,668553,703888,667812,702578,681608,666043,668502,695437,666010,694429,667857,706708,667422,706219,704965,666907,685752,666298,704896,668993,670059,665555,698655,668535,708819,688224,708935,660747,666932,675130,660199,662617,668488,660178,707196,657729,662207,668467,707053,661945,667580,710010,706329,661353,667192,666051,680428,705057,663904,668516,703142,668053,708838,667575,707705,666397,682020,706953,655895,689969,704998,711172,678250,702445,710103,674864,709175,671775,667028,707733,664712,707015,667605,685948,674503,695410,698804,687276,661392,697247,709303,707448,682065,618451,695659,706001,673962,668174,704973,666794,702497,689934,666452,662919,670423,673601,666382,700789,671302,665676,693578,708035,670382,686941,708018,669493,667405,685729,705087,667039,683301,700791,666195,710012,671717,700462,664303,661787,668708,663647,658281,668159,688196,663321,705049,667053,678273,705045,666199,674274,703679,675071,658691,668869,671592,666960,670036,666047,687590,665991,711033,677871,663920,704991,689905,704817,682289,700456,669060,707894,706988,667933,708061,700342,677743,665345,685352,667620,702678,692072,668979,704932,706883,698947,677482,664886,683367,667094,711165,702413,688451,668692,704929,706490,697119,677477,662515,683193,666498,710006,701685,688336,668501,704474,706484,696299,674668,661061,666006,709097,701676,681673,687867,668080,704178,706231,671479,654651,665879,701503,678271,686024,667649,704127,704962,694119,670037,708095,694099,666437,673047,701674,668110,670802,700349,667528,669922,667065,698958,694091,669051,665557,697404,688277,665406,677331,702414,668701,674420,668379,694144,708982,704999,671761,668125,670630,692620,701444,667522,692247,700316,665907,689474,695953,707194,641846,680990,709883,707049,708677,667344,699936,682723,707831,666946,698560,680250,706496,693473,666326,696719,676269,668807,705999,691446,663970,695211,671276,668582,709848,705378,689491,663463,670023,667929,703002,684366,670584,664855,666809,708165,668621,658143,664715,669030,685966,666284,706148,668177,656591,711079,664709,677134,666218,704987,667520,709889,664120,674236,665896,697132,667031,663524,671457,665410,695589,667016,660166,664109,663667,661851,659522,657409,666981,655598,669064,690287,667247,673760,663693,671692,670039,703456,666982,670287,708991,666476,704995,668586,673743,682670,704966,662339,676986,702417,660098,666801,674696,697084,656579,694093,707880,669075,666443,655995,687142,706526,669073,666000,683752,706335,665994,663487,678220,667214,653405,670851,667085,669012,700265,666053,665324,687715,668695,664045,681397,668173,668140,667064,708715,687407,666324,706516,680281,669570,687431,707241,667870,709916,667921,665388,705379,663586,651912,705353,661233,668061,702436,690312,667574,701631,685438,666099,670581,707477,665445,706257,664238,671748,657750,702459,683959,666023,666852,690510,669071,670849,700245,679484,664853,689862,666662,670563,668698,698736,675704,662668,694401,706468,688454,666655,711046,669924,668241,674524,662374,706134,686812,666478,710070,669697,667495,692537,671875,662370,705018,685262,666365,667251,691161,669103,668550,687178,673555,664757,683248,705230,681542,698941,685413,692226,668706,685952,657338,711164,678026,711160,673573,711019,669063,667412,702837,681465,702825,705756,663619,702589,662380,668742,697970,667386,666390,694792,687227,708691,665899,709452,707646,664549,664573,671242,670308,695343,668887,666784,665341,677003,666846,707156,666377,710128,682851,668893,692311,666559,695583,678172,688518,666556,668712,673944,708807,688322,666060,711155,668517,707645,669039,685658,665436,668059,704984,669037,683235,661989,693991,667340,696879,681688,707165,691797,710995,676661,662815,668479,695617,706983,689241,709915,671458,667704,705035,670095,687679,667225,682379,702422,669045,667008,679458,699114,708591,693938,678139,663416,697228,706386,668639,683981,705265,666269,704360,682086,665327,702506,680771,663420,708699,701617,670000,711049,661892,707073,709643,659063,687934,706179,706165,668711,705040,667824,667303,676626,666770,706540,666463,692379,666448,690360,677241,697487,666493,674824,668681,707054,666330,705043,664948,703480,657219,692451,708928,705145,668727,667224,706931,665051,699780,689219,664100,694861,669728,663037,668713,707534,668445,686667,667820,671499,667080,706327,666095,705294,698018,690614,661580,668866,668559,695587,667397,687156,666617,671373,663892,705272,674482,669376,710934,710190,703411,709908,667489,700542,666016,699748,692850,708817,665999,698538,671713,706600,659707,695455,670538,704204,691510,702901,667485,691180,697011,676612,697001,707104,667060,706976,666307,691561,710565,706467,665429,668821,708803,689388,705902,664103,668418,710360,708753,684350,700435,660449,668045,709836,707862,675050,657083,667351,709827,696913,706050,665843,703916,664250,710681,676359,689672,667967,704827,709844,670051,687438,667367,700956,684933,666873,698213,682181,666011,696656,707851,680060,662729,691472,695027,706486,699703,705964,685070,668810,708692,698290,705348,683067,668399,708669,696647,693628,703974,680030,667684,707636,695252,691304,703262,676342,667287,707106,710748,690279,701192,666007,706480,709519,687910,668813,706019,698300,707590,672708,689889,700974,706010,669673,684345,699753,705359,710557,668421,682444,698250,704847,709583,666313,679536,692866,696173,703315,661625,708497,676226,690984,702048,666127,710560,699953,706474,672566,709656,694002,665829,698841,705896,670799,690324,668812,696466,669970,705232,684509,668359,695139,702017,708671,682162,666862,701208,707802,679403,689725,699913,670035,666350,705287,683016,698296,665870,704196,679162,696675,702873,708664,676076,695170,693106,702202,710438,668464,706478,672716,691648,701175,709790,666918,705934,670907,705279,689887,665876,685701,704975,662357,678074,710888,703914,660692,707835,668070,706258,667350,704107,700936,685526,704382,694841,680034,702503,710359,708927,675357,666317,690852,701894,707935,673383,665350,701109,690714,706672,671057,663690,699767,690007,705993,697995,685408,690665,705314,667883,677004,707672,706292,662681,701770,705026,707433,673774,666495,709488,691487,710901,696467,683471,668411,662233,700783,704818,706689,671908,666470,704221,710812,696414,680509,667687,689005,661869,700758,706550,671751,665351,703354,694706,708502,677679,667629,686792,710215,660206,699691,705681,670663,664028,703128,708194,676279,667130,686535,710023,659422,699130,684921,705502,670552,663511,702150,707459,674865,667045,709557,648068,692572,697955,684044,668819,666468,689434,705506,696518,664946,688317,704379,695768,663030,677955,703487,662190,674114,701356,668482,692589,670572,710408,699883,639455,667324,691424,707955,709514,698275,701744,663643,681554,708796,700043,661564,677385,707741,710607,698898,660970,674754,706032,710018,695766,705282,666414,690018,703502,664918,685949,693874,710834,702988,663496,667690,679916,691278,709657,700507,658922,666576,677631,708557,689379,699738,654141,665872,624539,670466,688140,697864,707373,664579,685050,696285,706037,664064,683258,668442,694592,704988,695941,664148,703367,672446,666121,688341,667153,708500,695644,664044,702154,672432,665672,685518,667128,707771,663484,700952,671732,665619,683472,693632,706251,679034,666985,668817,663477,699721,670909,710741,665308,691371,705268,676845,666643,668268,655218,697990,669355,709280,664827,689430,704148,676691,666354,667932,702425,664265,684413,705952,710639,669330,708333,700927,662992,683473,668405,705338,667501,709616,692585,669065,708071,653011,680811,700023,704945,667030,709598,691394,707580,677197,698602,703947,666429,689702,707047,673982,696454,703063,665868,688153,706367,671639,708556,695423,708297,707126,710395,706501,709254,703990,642494,666050,670014,696168,682846,668443,702905,692701,708332,663898,679659,667904,694527,702147,691011,707179,662161,676242,667204,709522,701232,689396,706033,661820,666951,672567,699426,687456,705578,648619,666439,671059,698142,684510,668877,707566,670450,667590,693808,695674,710703,702097,706675,666783,689660,687956,701197,709624,706041,666253,684238,700250,705091,664793,682612,698637,703991,664296,708515,681115,668121,696438,703197,681630,699347,705757,663605,666462,677903,697665,705165,662915,665782,692926,668634,673934,695994,704000,662074,708287,665430,690388,702692,668087,695602,661559,671610,707123,664920,685965,702094,710230,667571,670070,664164,683082,700818,706494,709343,666893,703961,666953,688123,707473,696415,669762,702864,664152,682466,707387,694832,702110,680164,706491,693196,710450,699405,676288,668643,705919,691466,709252,698802,672574,667823,705264,689950,708311,697676,671038,667229,683460,699359,678165,707856,702085,667948,659828,669784,703940,668971,666065,687814,696412,671737,709381,705211,667004,691016,683305,699222,676568,706661,701887,667900,654698,669049,703440,668908,665706,686752,701684,695969,671391,708951,705180,666945,690268,698711,676307,711042,706330,667743,653133,694103,682459,702818,668469,665492,685713,700511,694718,670818,704677,666895,689337,698002,673073,710394,706051,667323,692582,680690,668412,664875,685493,700480,702496,670554,704091,666416,689068,694430,697504,673017,710072,705629,667227,692326,680206,661777,685197,700217,708200,702105,668404,669992,704002,666152,687962,697127,672689,710045,705224,667189,691093,679911,686687,699147,705231,684213,697573,703588,695942,702653,707264,692579,694481,701892,706364,688988,700608,705667,700284,695650,678241,705223,668052,689351,695484,709958,699843,673718,705196,666948,688244,693617,695300,698211,669066,704412,666851,687391,692725,698209,703446,665909,684306,706075,691904,691453,697275,701100,664866,681081,706023,668057,690376,697244,704785,666358,673297,693964,708630,697007,666207,691536,707098,695562,665249,691458,706852,668782,664221,689624,663509,706337,667241,705435,666998,685536,707112,664149,670281,709814,701047,667240,680444,707113,691451,661146,700047,667086,678119,705037,689736,99787,698228,666963,676191,704714,689587,697071,666323,674408,703952,687973,708748,691508,697005,666308,674007,702072,668049,685900,707114,691482,707110,709835,691425,708761,668770,701096,685923,707115,667834,699865,677805,706276,666924,696476,673739,705333,709781,666258,703437,694156,702384,666869,701949,710673,704831,676078,697120,705907,685507,691694,699970,666392,701450,668599,704616,674738,696798,705795,684185,709968,708702,691571,699545,701409,666292,668129,704405,670521,696442,705438,683447,709650,705364,681559,699409,707657,691363,666009,701049,667573,704319,669015,695594,705006,680964,698783,707392,690249,693897,660533,700962,667095,703381,694659,704877,677941,698519,706201,688303,692035,660147,700248,707738,710779,710008,708914,704403,691501,661601,703109,689350,668675,710903,702374,676270,665219,709066,664601,696640,672889,663881,695038,705190,692590,662928,705595,660096,680962,668182,693862,709692,704407,677904,667559,691588,698452,673002,708902,666593,689559,695699,671440,707726,666465,687964,705752,662930,685572,668753,698900,666035,673335,708066,710924,702006,681566,688299,667346,704369,695575,705491,691835,668231,698520,665339,671229,707724,710916,701435,680626,701020,666970,678240,708768,703885,687574,705361,691627,668108,694182,698194,664127,671202,706939,710797,700386,666927,677934,708759,703455,685736,704880,691547,667766,697256,663293,670496,706788,709965,700382,666858,674796,708237,703080,685692,704815,690396,667617,696179,648157,669535,706341,709880,700120,666275,674287,708069,711154,702014,682510,704456,689698,667566,695596,669027,705507,709635,692541,668563,669035,666407,677818,695705,703193,664787,674764,694150,702004,664781,671327,668538,691772,701023,664774,706347,670293,668156,709038,690384,700158,658209,705416,667472,687307,697389,704876,657656,700340,666863,710918,670494,691745,698732,663290,707931,710116,687718,695694,706602,668505,708981,677895,705496,668143,674407,703457,667423,671437,693807,701068,695779,703140,659687,706558,692116,701966,658125,706345,688404,700931,705540,674540,700406,668542,704414,670225,698306,704314,667482,710060,707756,668090,669699,698590,677807,705012,685914,668976,667037,706963,691933,668040,698430,673663,703383,683464,668930,665895,706262,691240,667475,696791,672641,702064,681358,668649,654374,711097,706252,689979,667444,695085,671292,681039,668444,700969,710187,705596,689915,667436,708788,694167,669928,668433,700374,677822,705315,688383,667429,707973,691951,669725,681239,677634,674227,691741,710185,668904,671348,689948,700982,668440,669660,683459,667417,706972,669914,710905,667013,685501,699689,706250,669074,710059,666367,683474,698564,705259,679004,695665,693572,668500,703388,708795,676603,691116,668031,689837,702175,707796,672483,667406,688203,701057,687282,656999,663691,665446,698482,667097,703987,670324,685774,656460,662737,707578,665311,696962,667096,703229,669019,683454,655913,668570,661929,706875,664718,694359,694113,666905,710498,702233,668029,661223,705638,677823,691250,664691,666262,710085,701080,667543,659714,705092,673122,689471,664217,665886,709108,699957,667498,657767,704912,671416,695770,663000,706342,673149,710154,692349,660620,704442,670505,668038,709043,690325,703447,667382,686101,701723,666786,707959,680843,699039,666366,707048,677401,711044,694149,683461,628531,694128,700335,660118,666904,704422,681582,691841,698901,652742,666483,703896,706338,710917,677326,690333,696684,649786,695604,665900,703449,705598,710077,668696,673269,688432,649014,664861,702420,705046,664334,709039,668157,671728,685872,646546,701681,704940,661765,667421,653909,697052,710169,666304,704948,685666,695685,709058,647790,664841,704438,683441,694146,646714,663632,703435,681563,668574,676325,692183,661767,701619,667420,671758,690317,660373,698913,666910,670372,688413,706225,679249,667796,668739,687550,665455,698279,669024,705237,677678,667585,710909,668632,687471,646911,697849,704881,672993,667447,710061,668381,685024,696871,703475,672848,667210,709548,668075,707757,681844,695003,691378,671603,666860,701601,667822,706995,681348,709057,694164,690202,670662,666473,700308,661950,689931,699382,709562,664279,706238,667496,671246,687665,698260,696966,661481,705347,666886,670159,684981,695007,659806,704693,708778,655275,666402,669058,681330,692745,702865,650359,665254,707381,668640,677693,691368,701396,711000,664857,707055,668167,674136,662996,703903,672905,667279,687519,696852,662016,702822,671428,666789,669773,708793,685076,695032,661134,702052,666502,669061,707662,682242,710858,654660,701149,666371,706348,681600,691410,709625,699542,664878,705212,677963,668449,689445,698226,702939,687726,686068,681696,667268,693486,666345,691364,704941,690270,687755,701199,673976,699622,710755,667512,706222,670491,698232,705381,696714,704479,691495,702137,697290,710856,662917,696929,687813,668100,707575,673267,706295,667363,670966,704960,666928,701238,710875,665989,707030,673948,705042,685888,681579,662288,674367,662211,667579,671225,693979,666992,705034,670561,689831,666333,700379,685386,710846,665258,698987,680484,674023,666823,701627,671774,666472,692221,697354,690412,688078,709703,685717,667863,704215,681376,668130,667710,688953,665966,692483,688112,655254,666405,704961,710908,685904,665736,703277,709161,673928,701625,665407,707529,670487,697251,663467,668179,706312,689423,661852,666906,705200,685748,673471,666466,671510,668145,598196,704971,691400,708998,667296,673854,200243,700195,687942,667005,695788,685457,711060,663694,681660,661797,711024,668800,677038,641844,708073,691765,709802,668554,676720,684108,666599,711069,682873,662202,676776,660998,707025,672644,691203,668363,689147,667302,711053,668617,671064,709438,666596,708083,669852,687830,663575,706619,669838,685454,662282,681877,680733,672802,668549,695792,669820,667010,666120,691878,708079,665898,685561,710331,705351,662173,682917,710032,700955,660995,672713,674427,693603,664736,668128,670006,687266,711166,662759,708782,667409,681626,709986,661646,666930,677475,612164,666309,669010,676119,444,665904,668496,700287,668709,668097,665715,673565,708029,665875,710870,687415,685689,707595,673971,706729,670611,706336,704969,693099,665995,711170,690367,705063,667329,666469,710556,681420,666020,709796,705992,642991,666962,711135,694075,664343,709941,679937,657581,706339,655318,705050,654610,668010,681316,706529,705074,704482,690080,668150,663889,708040,683287,710930,670623,701667,681363,706331,666656,691865,670619,700185,680373,704740,666136,690314,710739,669050,696620,677010,675038,703897,661960,687826,668528,709933,694453,674318,703340,685591,667961,709092,671494,702389,683363,707783,667427,693602,692420,707901,687461,705533,682680,703492,659703,677485,700544,698893,672696,13047,685524,710110,11749,666046,681692,708087,662245,678301,700540,660736,674455,692469,671515,700538,56709,690401,701713,700142,707007,705430,704423,703509,710113,684461,667503,672608,682361,701624,671139,681445,693191,670262,680259,692414,668806,677155,685691,668093,673895,673370,702442,664944,707964,670868,670574,664346,707052,668377,657197,705058,667920,693159,704983,667488,709549,686920,704507,666032,680774,671471,674026,709887,707886,695334,705000,666500,668633,711173,678300,702412,650643,667631,710086,674249,700463,667504,709171,708038,671755,692429,697249,706921,666796,670598,688280,705060,666501,669047,681647,657068,674572,668056,710139,700127,680227,699063,668060,667555,709994,708975,707422,687868,15747,707942,700457,689744,694739,688213,704986,688008,694768,702408,707867,666150,671659,710651,685241,700140,706534,705988,669980,709979,668955,682401,698543,705429,668434,679617,691918,697167,703865,667493,676840,690243,695513,703380,708568,666780,673576,688229,663550,705062,706581,667500,680876,708740,697235,703493,666782,677799,707917,694843,701758,677232,706191,688266,666779,668798,701690,705444,688194,666154,668600,698975,704977,685700,710984,666001,667596,698968,703532,680928,709960,665992,653197,652493,660083,657182,656057,701658,653874,667610,674388,700465,687202,662283,707022,671704,666702,711162,699090,686005,705572,666057,710898,698831,683478,705029,665880,709109,694165,681443,692168,703525,665465,668593,678227,690385,701635,708031,663531,662732,662347,661519,686540,656072,709005,698514,656646,710910,673524,704253,667636,683264,707638,687653,669638,695421,710843,671727,703966,667381,681339,707548,685631,669029,695416,710754,671544,702911,667338,681136,706300,685368,668547,695325,709980,671308,700285,667325,676581,705554,685246,668389,695123,709898,670456,700233,666725,673725,705395,668285,684311,708812,709897,688164,670191,699952,708528,707606,704974,707629,665356,702415,691512,668937,707503,677800,655440,664352,701311,688906,668572,706775,677685,653924,663389,700339,687831,667347,710879,706059,672526,661666,698753,684928,666744,710796,705054,671477,708842,661234,670579,697069,682201,666123,709871,703443,707938,657728,694982,681493,663043,668001,689870,707666,674219,709143,698659,677945,703504,665360,667194,668684,687405,706937,673150,709094,695709,677721,703489,664448,667070,668614,686450,706936,671768,694224,677665,702507,664363,666663,668503,685153,706874,692266,670544,674809,701644,661191,701414,668191,681525,705360,666045,692141,707759,670338,674480,710164,700317,668027,678173,705016,665906,710135,707832,709115,710039,664344,681690,704978,709112,677628,702426,700392,692344,668592,674587,690163,707896,667362,688424,706678,711109,666335,685788,706228,710090,686104,674255,698858,692175,683450,668580,705067,692471,661622,665500,694264,670608,681387,668149,703528,692432,660064,664342,670592,709144,667614,702271,678229,690398,708589,663622,670198,709021,667062,701710,678158,688558,668677,708097,669072,662904,666494,699002,674636,688423,668673,706933,662298,665894,694350,671760,704934,662137,668096,700403,660709,665403,660002,664956,706924,694141,664340,705478,677976,662991,675446,707956,674229,707027,697406,670083,668662,667516,665792,666717,666417,666360,669054,667595,666980,666440,664310,671531,662866,670165,668705,659926,674699,664316,671764,662865,670575,659940,668607,657773,667054,666332,690003,662856,688363,678124,660004,668581,674037,668101,671545,667562,670195,666748,664320,692189)
order by field(bpr.id, 674721,711004,665983,706525,688488,665905,704979,686499,662605,699087,681894,660232,676963,208570,666056,708292,666619,684816,694563,669877,703300,707168,666109,683008,702421,706520,665290,668932,676796,673173,692623,701652,706313,664082,668331,672884,689592,710517,700152,704685,662719,667507,671520,688245,709510,698424,704243,708195,709719,707174,704985,683810,666128,698833,668939,670664,710960,704848,682501,665884,692982,694894,668921,670117,710121,702922,708688,680540,691124,667327,702424,706723,676857,690327,666554,701548,674280,706294,688270,666548,699128,671597,704980,699393,667023,670310,694320,666551,666288,659531,694011,706757,657189,667513,685778,704981,656494,704883,664688,700425,659691,706031,682730,697281,657744,668991,705599,677860,695285,622633,668686,704500,708899,670010,667087,701709,661782,706508,666442,701297,661231,706045,685960,710188,706340,681686,661228,668187,699055,705053,677463,711078,667387,695774,705015,673874,710186,689330,667051,668556,702439,671564,709901,683674,708098,667043,668552,701637,669613,709095,707051,682453,664765,668188,700028,708943,707601,677667,677294,705017,700038,710009,670449,667012,711103,683283,701712,706121,692363,666552,710781,680910,668975,705052,689977,700369,664818,709244,677509,668676,704924,688235,698973,709086,674619,668160,704004,687353,697250,702608,708100,671750,667552,686089,695719,702429,706783,694012,666557,679868,708931,692046,701211,664012,711168,682130,704501,666504,682056,699089,666503,682039,666119,707275,660531,668178,705597,667089,667040,692151,666059,682973,681359,661226,705041,670809,693835,5798,668663,670808,704061,691292,667955,702438,684964,666870,666044,708912,710002,673872,664210,707563,671589,683014,690343,698180,689916,695074,688634,695049,709301,688314,706227,686648,691396,704970,680809,677733,699755,655302,666062,691440,708059,667898,674269,698288,690223,706457,666005,667594,674231,697242,688361,704976,665910,667254,670515,694851,686070,701431,662277,667061,668605,681211,699770,657684,667000,692105,668171,702251,666939,703364,678087,710024,689545,666432,702441,668849,708099,708994,673957,685891,664153,701660,668354,699990,706996,671747,683247,660963,667799,694692,705748,669558,681472,667280,704802,678109,661100,697016,666818,705971,666049,704964,664029,698857,675047,645714,667379,706266,632156,667058,662751,705291,666959,662313,664800,651284,651138,668888,709849,668181,669052,665019,681401,694790,668341,706464,662860,702513,683054,701645,709060,698508,35759,701571,676405,672408,668784,705458,680413,692847,666987,706938,685718,665433,705047,670208,668660,663032,697034,671523,693850,667607,695060,709943,691294,666361,709031,687880,662168,677640,659538,673237,698370,673682,656265,710868,668767,705051,668553,703888,667812,702578,681608,666043,668502,695437,666010,694429,667857,706708,667422,706219,704965,666907,685752,666298,704896,668993,670059,665555,698655,668535,708819,688224,708935,660747,666932,675130,660199,662617,668488,660178,707196,657729,662207,668467,707053,661945,667580,710010,706329,661353,667192,666051,680428,705057,663904,668516,703142,668053,708838,667575,707705,666397,682020,706953,655895,689969,704998,711172,678250,702445,710103,674864,709175,671775,667028,707733,664712,707015,667605,685948,674503,695410,698804,687276,661392,697247,709303,707448,682065,618451,695659,706001,673962,668174,704973,666794,702497,689934,666452,662919,670423,673601,666382,700789,671302,665676,693578,708035,670382,686941,708018,669493,667405,685729,705087,667039,683301,700791,666195,710012,671717,700462,664303,661787,668708,663647,658281,668159,688196,663321,705049,667053,678273,705045,666199,674274,703679,675071,658691,668869,671592,666960,670036,666047,687590,665991,711033,677871,663920,704991,689905,704817,682289,700456,669060,707894,706988,667933,708061,700342,677743,665345,685352,667620,702678,692072,668979,704932,706883,698947,677482,664886,683367,667094,711165,702413,688451,668692,704929,706490,697119,677477,662515,683193,666498,710006,701685,688336,668501,704474,706484,696299,674668,661061,666006,709097,701676,681673,687867,668080,704178,706231,671479,654651,665879,701503,678271,686024,667649,704127,704962,694119,670037,708095,694099,666437,673047,701674,668110,670802,700349,667528,669922,667065,698958,694091,669051,665557,697404,688277,665406,677331,702414,668701,674420,668379,694144,708982,704999,671761,668125,670630,692620,701444,667522,692247,700316,665907,689474,695953,707194,641846,680990,709883,707049,708677,667344,699936,682723,707831,666946,698560,680250,706496,693473,666326,696719,676269,668807,705999,691446,663970,695211,671276,668582,709848,705378,689491,663463,670023,667929,703002,684366,670584,664855,666809,708165,668621,658143,664715,669030,685966,666284,706148,668177,656591,711079,664709,677134,666218,704987,667520,709889,664120,674236,665896,697132,667031,663524,671457,665410,695589,667016,660166,664109,663667,661851,659522,657409,666981,655598,669064,690287,667247,673760,663693,671692,670039,703456,666982,670287,708991,666476,704995,668586,673743,682670,704966,662339,676986,702417,660098,666801,674696,697084,656579,694093,707880,669075,666443,655995,687142,706526,669073,666000,683752,706335,665994,663487,678220,667214,653405,670851,667085,669012,700265,666053,665324,687715,668695,664045,681397,668173,668140,667064,708715,687407,666324,706516,680281,669570,687431,707241,667870,709916,667921,665388,705379,663586,651912,705353,661233,668061,702436,690312,667574,701631,685438,666099,670581,707477,665445,706257,664238,671748,657750,702459,683959,666023,666852,690510,669071,670849,700245,679484,664853,689862,666662,670563,668698,698736,675704,662668,694401,706468,688454,666655,711046,669924,668241,674524,662374,706134,686812,666478,710070,669697,667495,692537,671875,662370,705018,685262,666365,667251,691161,669103,668550,687178,673555,664757,683248,705230,681542,698941,685413,692226,668706,685952,657338,711164,678026,711160,673573,711019,669063,667412,702837,681465,702825,705756,663619,702589,662380,668742,697970,667386,666390,694792,687227,708691,665899,709452,707646,664549,664573,671242,670308,695343,668887,666784,665341,677003,666846,707156,666377,710128,682851,668893,692311,666559,695583,678172,688518,666556,668712,673944,708807,688322,666060,711155,668517,707645,669039,685658,665436,668059,704984,669037,683235,661989,693991,667340,696879,681688,707165,691797,710995,676661,662815,668479,695617,706983,689241,709915,671458,667704,705035,670095,687679,667225,682379,702422,669045,667008,679458,699114,708591,693938,678139,663416,697228,706386,668639,683981,705265,666269,704360,682086,665327,702506,680771,663420,708699,701617,670000,711049,661892,707073,709643,659063,687934,706179,706165,668711,705040,667824,667303,676626,666770,706540,666463,692379,666448,690360,677241,697487,666493,674824,668681,707054,666330,705043,664948,703480,657219,692451,708928,705145,668727,667224,706931,665051,699780,689219,664100,694861,669728,663037,668713,707534,668445,686667,667820,671499,667080,706327,666095,705294,698018,690614,661580,668866,668559,695587,667397,687156,666617,671373,663892,705272,674482,669376,710934,710190,703411,709908,667489,700542,666016,699748,692850,708817,665999,698538,671713,706600,659707,695455,670538,704204,691510,702901,667485,691180,697011,676612,697001,707104,667060,706976,666307,691561,710565,706467,665429,668821,708803,689388,705902,664103,668418,710360,708753,684350,700435,660449,668045,709836,707862,675050,657083,667351,709827,696913,706050,665843,703916,664250,710681,676359,689672,667967,704827,709844,670051,687438,667367,700956,684933,666873,698213,682181,666011,696656,707851,680060,662729,691472,695027,706486,699703,705964,685070,668810,708692,698290,705348,683067,668399,708669,696647,693628,703974,680030,667684,707636,695252,691304,703262,676342,667287,707106,710748,690279,701192,666007,706480,709519,687910,668813,706019,698300,707590,672708,689889,700974,706010,669673,684345,699753,705359,710557,668421,682444,698250,704847,709583,666313,679536,692866,696173,703315,661625,708497,676226,690984,702048,666127,710560,699953,706474,672566,709656,694002,665829,698841,705896,670799,690324,668812,696466,669970,705232,684509,668359,695139,702017,708671,682162,666862,701208,707802,679403,689725,699913,670035,666350,705287,683016,698296,665870,704196,679162,696675,702873,708664,676076,695170,693106,702202,710438,668464,706478,672716,691648,701175,709790,666918,705934,670907,705279,689887,665876,685701,704975,662357,678074,710888,703914,660692,707835,668070,706258,667350,704107,700936,685526,704382,694841,680034,702503,710359,708927,675357,666317,690852,701894,707935,673383,665350,701109,690714,706672,671057,663690,699767,690007,705993,697995,685408,690665,705314,667883,677004,707672,706292,662681,701770,705026,707433,673774,666495,709488,691487,710901,696467,683471,668411,662233,700783,704818,706689,671908,666470,704221,710812,696414,680509,667687,689005,661869,700758,706550,671751,665351,703354,694706,708502,677679,667629,686792,710215,660206,699691,705681,670663,664028,703128,708194,676279,667130,686535,710023,659422,699130,684921,705502,670552,663511,702150,707459,674865,667045,709557,648068,692572,697955,684044,668819,666468,689434,705506,696518,664946,688317,704379,695768,663030,677955,703487,662190,674114,701356,668482,692589,670572,710408,699883,639455,667324,691424,707955,709514,698275,701744,663643,681554,708796,700043,661564,677385,707741,710607,698898,660970,674754,706032,710018,695766,705282,666414,690018,703502,664918,685949,693874,710834,702988,663496,667690,679916,691278,709657,700507,658922,666576,677631,708557,689379,699738,654141,665872,624539,670466,688140,697864,707373,664579,685050,696285,706037,664064,683258,668442,694592,704988,695941,664148,703367,672446,666121,688341,667153,708500,695644,664044,702154,672432,665672,685518,667128,707771,663484,700952,671732,665619,683472,693632,706251,679034,666985,668817,663477,699721,670909,710741,665308,691371,705268,676845,666643,668268,655218,697990,669355,709280,664827,689430,704148,676691,666354,667932,702425,664265,684413,705952,710639,669330,708333,700927,662992,683473,668405,705338,667501,709616,692585,669065,708071,653011,680811,700023,704945,667030,709598,691394,707580,677197,698602,703947,666429,689702,707047,673982,696454,703063,665868,688153,706367,671639,708556,695423,708297,707126,710395,706501,709254,703990,642494,666050,670014,696168,682846,668443,702905,692701,708332,663898,679659,667904,694527,702147,691011,707179,662161,676242,667204,709522,701232,689396,706033,661820,666951,672567,699426,687456,705578,648619,666439,671059,698142,684510,668877,707566,670450,667590,693808,695674,710703,702097,706675,666783,689660,687956,701197,709624,706041,666253,684238,700250,705091,664793,682612,698637,703991,664296,708515,681115,668121,696438,703197,681630,699347,705757,663605,666462,677903,697665,705165,662915,665782,692926,668634,673934,695994,704000,662074,708287,665430,690388,702692,668087,695602,661559,671610,707123,664920,685965,702094,710230,667571,670070,664164,683082,700818,706494,709343,666893,703961,666953,688123,707473,696415,669762,702864,664152,682466,707387,694832,702110,680164,706491,693196,710450,699405,676288,668643,705919,691466,709252,698802,672574,667823,705264,689950,708311,697676,671038,667229,683460,699359,678165,707856,702085,667948,659828,669784,703940,668971,666065,687814,696412,671737,709381,705211,667004,691016,683305,699222,676568,706661,701887,667900,654698,669049,703440,668908,665706,686752,701684,695969,671391,708951,705180,666945,690268,698711,676307,711042,706330,667743,653133,694103,682459,702818,668469,665492,685713,700511,694718,670818,704677,666895,689337,698002,673073,710394,706051,667323,692582,680690,668412,664875,685493,700480,702496,670554,704091,666416,689068,694430,697504,673017,710072,705629,667227,692326,680206,661777,685197,700217,708200,702105,668404,669992,704002,666152,687962,697127,672689,710045,705224,667189,691093,679911,686687,699147,705231,684213,697573,703588,695942,702653,707264,692579,694481,701892,706364,688988,700608,705667,700284,695650,678241,705223,668052,689351,695484,709958,699843,673718,705196,666948,688244,693617,695300,698211,669066,704412,666851,687391,692725,698209,703446,665909,684306,706075,691904,691453,697275,701100,664866,681081,706023,668057,690376,697244,704785,666358,673297,693964,708630,697007,666207,691536,707098,695562,665249,691458,706852,668782,664221,689624,663509,706337,667241,705435,666998,685536,707112,664149,670281,709814,701047,667240,680444,707113,691451,661146,700047,667086,678119,705037,689736,99787,698228,666963,676191,704714,689587,697071,666323,674408,703952,687973,708748,691508,697005,666308,674007,702072,668049,685900,707114,691482,707110,709835,691425,708761,668770,701096,685923,707115,667834,699865,677805,706276,666924,696476,673739,705333,709781,666258,703437,694156,702384,666869,701949,710673,704831,676078,697120,705907,685507,691694,699970,666392,701450,668599,704616,674738,696798,705795,684185,709968,708702,691571,699545,701409,666292,668129,704405,670521,696442,705438,683447,709650,705364,681559,699409,707657,691363,666009,701049,667573,704319,669015,695594,705006,680964,698783,707392,690249,693897,660533,700962,667095,703381,694659,704877,677941,698519,706201,688303,692035,660147,700248,707738,710779,710008,708914,704403,691501,661601,703109,689350,668675,710903,702374,676270,665219,709066,664601,696640,672889,663881,695038,705190,692590,662928,705595,660096,680962,668182,693862,709692,704407,677904,667559,691588,698452,673002,708902,666593,689559,695699,671440,707726,666465,687964,705752,662930,685572,668753,698900,666035,673335,708066,710924,702006,681566,688299,667346,704369,695575,705491,691835,668231,698520,665339,671229,707724,710916,701435,680626,701020,666970,678240,708768,703885,687574,705361,691627,668108,694182,698194,664127,671202,706939,710797,700386,666927,677934,708759,703455,685736,704880,691547,667766,697256,663293,670496,706788,709965,700382,666858,674796,708237,703080,685692,704815,690396,667617,696179,648157,669535,706341,709880,700120,666275,674287,708069,711154,702014,682510,704456,689698,667566,695596,669027,705507,709635,692541,668563,669035,666407,677818,695705,703193,664787,674764,694150,702004,664781,671327,668538,691772,701023,664774,706347,670293,668156,709038,690384,700158,658209,705416,667472,687307,697389,704876,657656,700340,666863,710918,670494,691745,698732,663290,707931,710116,687718,695694,706602,668505,708981,677895,705496,668143,674407,703457,667423,671437,693807,701068,695779,703140,659687,706558,692116,701966,658125,706345,688404,700931,705540,674540,700406,668542,704414,670225,698306,704314,667482,710060,707756,668090,669699,698590,677807,705012,685914,668976,667037,706963,691933,668040,698430,673663,703383,683464,668930,665895,706262,691240,667475,696791,672641,702064,681358,668649,654374,711097,706252,689979,667444,695085,671292,681039,668444,700969,710187,705596,689915,667436,708788,694167,669928,668433,700374,677822,705315,688383,667429,707973,691951,669725,681239,677634,674227,691741,710185,668904,671348,689948,700982,668440,669660,683459,667417,706972,669914,710905,667013,685501,699689,706250,669074,710059,666367,683474,698564,705259,679004,695665,693572,668500,703388,708795,676603,691116,668031,689837,702175,707796,672483,667406,688203,701057,687282,656999,663691,665446,698482,667097,703987,670324,685774,656460,662737,707578,665311,696962,667096,703229,669019,683454,655913,668570,661929,706875,664718,694359,694113,666905,710498,702233,668029,661223,705638,677823,691250,664691,666262,710085,701080,667543,659714,705092,673122,689471,664217,665886,709108,699957,667498,657767,704912,671416,695770,663000,706342,673149,710154,692349,660620,704442,670505,668038,709043,690325,703447,667382,686101,701723,666786,707959,680843,699039,666366,707048,677401,711044,694149,683461,628531,694128,700335,660118,666904,704422,681582,691841,698901,652742,666483,703896,706338,710917,677326,690333,696684,649786,695604,665900,703449,705598,710077,668696,673269,688432,649014,664861,702420,705046,664334,709039,668157,671728,685872,646546,701681,704940,661765,667421,653909,697052,710169,666304,704948,685666,695685,709058,647790,664841,704438,683441,694146,646714,663632,703435,681563,668574,676325,692183,661767,701619,667420,671758,690317,660373,698913,666910,670372,688413,706225,679249,667796,668739,687550,665455,698279,669024,705237,677678,667585,710909,668632,687471,646911,697849,704881,672993,667447,710061,668381,685024,696871,703475,672848,667210,709548,668075,707757,681844,695003,691378,671603,666860,701601,667822,706995,681348,709057,694164,690202,670662,666473,700308,661950,689931,699382,709562,664279,706238,667496,671246,687665,698260,696966,661481,705347,666886,670159,684981,695007,659806,704693,708778,655275,666402,669058,681330,692745,702865,650359,665254,707381,668640,677693,691368,701396,711000,664857,707055,668167,674136,662996,703903,672905,667279,687519,696852,662016,702822,671428,666789,669773,708793,685076,695032,661134,702052,666502,669061,707662,682242,710858,654660,701149,666371,706348,681600,691410,709625,699542,664878,705212,677963,668449,689445,698226,702939,687726,686068,681696,667268,693486,666345,691364,704941,690270,687755,701199,673976,699622,710755,667512,706222,670491,698232,705381,696714,704479,691495,702137,697290,710856,662917,696929,687813,668100,707575,673267,706295,667363,670966,704960,666928,701238,710875,665989,707030,673948,705042,685888,681579,662288,674367,662211,667579,671225,693979,666992,705034,670561,689831,666333,700379,685386,710846,665258,698987,680484,674023,666823,701627,671774,666472,692221,697354,690412,688078,709703,685717,667863,704215,681376,668130,667710,688953,665966,692483,688112,655254,666405,704961,710908,685904,665736,703277,709161,673928,701625,665407,707529,670487,697251,663467,668179,706312,689423,661852,666906,705200,685748,673471,666466,671510,668145,598196,704971,691400,708998,667296,673854,200243,700195,687942,667005,695788,685457,711060,663694,681660,661797,711024,668800,677038,641844,708073,691765,709802,668554,676720,684108,666599,711069,682873,662202,676776,660998,707025,672644,691203,668363,689147,667302,711053,668617,671064,709438,666596,708083,669852,687830,663575,706619,669838,685454,662282,681877,680733,672802,668549,695792,669820,667010,666120,691878,708079,665898,685561,710331,705351,662173,682917,710032,700955,660995,672713,674427,693603,664736,668128,670006,687266,711166,662759,708782,667409,681626,709986,661646,666930,677475,612164,666309,669010,676119,444,665904,668496,700287,668709,668097,665715,673565,708029,665875,710870,687415,685689,707595,673971,706729,670611,706336,704969,693099,665995,711170,690367,705063,667329,666469,710556,681420,666020,709796,705992,642991,666962,711135,694075,664343,709941,679937,657581,706339,655318,705050,654610,668010,681316,706529,705074,704482,690080,668150,663889,708040,683287,710930,670623,701667,681363,706331,666656,691865,670619,700185,680373,704740,666136,690314,710739,669050,696620,677010,675038,703897,661960,687826,668528,709933,694453,674318,703340,685591,667961,709092,671494,702389,683363,707783,667427,693602,692420,707901,687461,705533,682680,703492,659703,677485,700544,698893,672696,13047,685524,710110,11749,666046,681692,708087,662245,678301,700540,660736,674455,692469,671515,700538,56709,690401,701713,700142,707007,705430,704423,703509,710113,684461,667503,672608,682361,701624,671139,681445,693191,670262,680259,692414,668806,677155,685691,668093,673895,673370,702442,664944,707964,670868,670574,664346,707052,668377,657197,705058,667920,693159,704983,667488,709549,686920,704507,666032,680774,671471,674026,709887,707886,695334,705000,666500,668633,711173,678300,702412,650643,667631,710086,674249,700463,667504,709171,708038,671755,692429,697249,706921,666796,670598,688280,705060,666501,669047,681647,657068,674572,668056,710139,700127,680227,699063,668060,667555,709994,708975,707422,687868,15747,707942,700457,689744,694739,688213,704986,688008,694768,702408,707867,666150,671659,710651,685241,700140,706534,705988,669980,709979,668955,682401,698543,705429,668434,679617,691918,697167,703865,667493,676840,690243,695513,703380,708568,666780,673576,688229,663550,705062,706581,667500,680876,708740,697235,703493,666782,677799,707917,694843,701758,677232,706191,688266,666779,668798,701690,705444,688194,666154,668600,698975,704977,685700,710984,666001,667596,698968,703532,680928,709960,665992,653197,652493,660083,657182,656057,701658,653874,667610,674388,700465,687202,662283,707022,671704,666702,711162,699090,686005,705572,666057,710898,698831,683478,705029,665880,709109,694165,681443,692168,703525,665465,668593,678227,690385,701635,708031,663531,662732,662347,661519,686540,656072,709005,698514,656646,710910,673524,704253,667636,683264,707638,687653,669638,695421,710843,671727,703966,667381,681339,707548,685631,669029,695416,710754,671544,702911,667338,681136,706300,685368,668547,695325,709980,671308,700285,667325,676581,705554,685246,668389,695123,709898,670456,700233,666725,673725,705395,668285,684311,708812,709897,688164,670191,699952,708528,707606,704974,707629,665356,702415,691512,668937,707503,677800,655440,664352,701311,688906,668572,706775,677685,653924,663389,700339,687831,667347,710879,706059,672526,661666,698753,684928,666744,710796,705054,671477,708842,661234,670579,697069,682201,666123,709871,703443,707938,657728,694982,681493,663043,668001,689870,707666,674219,709143,698659,677945,703504,665360,667194,668684,687405,706937,673150,709094,695709,677721,703489,664448,667070,668614,686450,706936,671768,694224,677665,702507,664363,666663,668503,685153,706874,692266,670544,674809,701644,661191,701414,668191,681525,705360,666045,692141,707759,670338,674480,710164,700317,668027,678173,705016,665906,710135,707832,709115,710039,664344,681690,704978,709112,677628,702426,700392,692344,668592,674587,690163,707896,667362,688424,706678,711109,666335,685788,706228,710090,686104,674255,698858,692175,683450,668580,705067,692471,661622,665500,694264,670608,681387,668149,703528,692432,660064,664342,670592,709144,667614,702271,678229,690398,708589,663622,670198,709021,667062,701710,678158,688558,668677,708097,669072,662904,666494,699002,674636,688423,668673,706933,662298,665894,694350,671760,704934,662137,668096,700403,660709,665403,660002,664956,706924,694141,664340,705478,677976,662991,675446,707956,674229,707027,697406,670083,668662,667516,665792,666717,666417,666360,669054,667595,666980,666440,664310,671531,662866,670165,668705,659926,674699,664316,671764,662865,670575,659940,668607,657773,667054,666332,690003,662856,688363,678124,660004,668581,674037,668101,671545,667562,670195,666748,664320,692189)



-- for Fong
select bpr.date_report, sme.`g-dept`, sme.dept, sme.sec_branch , sme.unit_no, sme.unit, bpr.staff_no , sme.staff_name, bpr.`case`, bpr.`type` , bpr.usd_loan_amount, bpr.case_no, bpr.contract_no, bp.customer_name, bp.customer_tel, bpr.rank_update, bpr.now_result ,
	bpr.disbursement_date_pay_date, bpr.which , bpr.id, bpr.comments 
from SME_BO_and_Plan_report bpr left join tabSME_BO_and_Plan bp on (bpr.id = bp.name)
left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
-- where (bpr.now_result not in ('Contracted', 'Cancelled') and bpr.date_report < '2024-04-01') or bpr.date_report >= '2024-04-01'
 where bpr.disbursement_date_pay_date between '2024-06-10' and '2024-07-31' and bpr.usd_loan_amount >= 10000
-- where bp.name in ()
order by sme.id asc ;


select case when bpr.date_report is null then date(now()) else bpr.date_report end `date_report`, sme.staff_no, sme.staff_name, sme.sec_branch, 1 `case`, case when bp.`type` = 'New' then 'NEW' when bp.`type` = 'Dor' then 'DOR' when bp.`type` = 'Inc' then 'INC' end `type`,
	bp.usd_loan_amount, bp.case_no, bp.contract_no, -- bp.customer_name, 
	concat('=HYPERLINK("http://13.250.153.252:8000/app/sme_bo_and_plan/"&',bp.name,',', '"' , bp.customer_name, '"',')' ) `customer_name`,
	bp.rank_update,
	case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' 
		when bp.ringi_status = 'Approved' then 'APPROVED' when bp.ringi_status = 'Pending approval' then 'PENDING' 
		when bp.ringi_status = 'Draft' then 'DRAFT' when bp.ringi_status = 'Not Ringi' then 'No Ringi' 
	end `now_result`, 
	bp.disbursement_date_pay_date , 
	case when bpr.id is null and (bp.disbursement_date_pay_date is null or bp.disbursement_date_pay_date < date(now())) then null 
		when bp.disbursement_date_pay_date >= date(Now()) then 'ແຜນເພີ່ມ' when bpr.which is null then null
		when bpr.id is not null then 'ແຜນເພີ່ມ' else bpr.which
	end `which`, 
	bp.name `id`, case when bp.credit_remark is not null then bp.credit_remark else bp.contract_comment end `comments`,
	bp.credit , bp.modified 
from tabSME_BO_and_Plan bp left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
left join SME_BO_and_Plan_report bpr on (bpr.id = bp.name)
where bp.name in (665905,662605,660232,208570,666056,665983,665290,664082,662719,665884,665405,664818,664339,657189,656494,659531,665480,664765,661228,666060,665436,660531,661231,659691,657744,661782,651284,651138,645714,664800,662751,632156,662313,660710,665019,661100,666049,665903,664029,662860,662380,665899,664549,663619,665341,664573,656265,666043,666010,665433,663032,665227,665869,664736,662759,661646,612164,665904,663416,662815,665327,663420,659063,665555,655598,655895,662919,661392,664120,665786,663524,665410,660166,664855,658143,664715,656591,664709,665896,664109,663667,661851,657409,666047,665991,663920,655302,666005,665910,662277,660525,657684,666062,664153,660963,660199,662617,660178,662207,657729,661945,661353,660747,663904,666051,665445,664238,661233,664012,664688,665907,641846,663970,666000,665994,662339,660098,656579,655995,657338,663693,662374,662370,657750,666023,664853,662668,664757,661226,666044,664210,666006,654651,665879,665345,664886,662515,661061,665557,665406,664045,663487,653405,666053,665324,665388,663586,651912,664303,663647,663321,661787,658281,665715,664948,657219,663892,661580,665051,664100,663037,666095,665429,664103,660449,657083,660692,665876,666007,662729,664251,652025,665882,665874,665401,665384,661625,665870,665843,664250,665829,663690,665350,666016,665999,659707,648068,665351,662233,584252,664918,661869,661564,664028,660970,663643,663511,660206,665811,662681,664946,663030,662190,639455,664064,663496,659422,665872,654141,664579,624539,663484,665308,663477,665291,655218,664827,664148,665672,664044,665619,665868,664265,653011,665492,664875,661777,666065,659828,665706,654698,665688,653133,656820,655335,665758,665136,663576,665782,662074,665430,661559,664920,664164,663605,662915,664793,664296,661820,648619,666050,642494,665815,663898,662161,664152,665909,664866,665249,664221,663509,661579,664149,663314,661146,99787,660533,660147,665219,664601,663881,662928,661601,662930,660096,664127,663293,648157,666035,665339,664787,664781,664774,658209,657656,663290,659687,658125,654374,665895,664217,657767,665886,656999,663691,665446,656460,662737,665311,655913,661929,664718,661223,664691,659714,660620,663000,661765,660118,649786,665900,649014,664334,647790,663632,661767,660373,653909,646911,665455,661950,659806,655275,650359,665254,664857,664279,661481,661134,654660,664878,662996,662016,665989,662917,665736,665407,663467,661852,655254,665258,662288,655318,654610,642991,657581,665898,663694,661797,641844,662202,660998,663575,662282,662173,660995,665995,665875,665877,661960,663889,56709,666046,662245,659703,657197,666032,664944,664346,650643,657068,665992,657182,656057,653874,653197,652493,656646,657728,665356,655440,664352,653924,663389,661666,661234,663043,664344,664448,664363,662910,666045,661191,665906,665360,664797,660064,664342,605771,663622,662904,662298,665894,661622,665500,662347,661519,656072,662732,664340,662991,662137,660709,665403,660002,664956,665792,666057,665880,664310,662866,659926,659940,657773,664316,662865,662856,660004,665465,664320)
	and bp.credit = '4145 - FONG' and bp.modified >= '2024-07-01';



reset query cache;
flush query cache;
show processlist;
kill connection 342170;
kill connection 342171;
kill connection 342172;


CREATE INDEX tabSME_BO_and_Plan_rank1_IDX USING BTREE ON tabSME_BO_and_Plan (rank1);

select * from tabSME_BO_and_Plan where callcenter_of_sales like '4297%' and creation >= '2024-07-01'

-- xyz to import to tabsme_Sales_partner
insert into tabsme_Sales_partner (`current_staff`, `owner_staff`, `broker_type`, `broker_name`, `broker_tel`, `address_province_and_city`, `address_village`, `business_type`,
	`year`, `refer_id`, `refer_type`, `creation`, `modified`, `owner`)
;select case when bp.callcenter_of_sales is not null then bp.callcenter_of_sales else bp.staff_no end `current_staff` , 
	bp.own_salesperson `owner_staff`, bp.is_sales_partner `broker_type`, bp.customer_name `broker_name`, bp.customer_tel `broker_tel`,
	bp.address_province_and_city, bp.address_village, bp.business_type, bp.`year`, bp.name `refer_id`, 'tabSME_BO_and_Plan' `refer_type`,
	bp.creation, bp.modified, bp.owner
from tabSME_BO_and_Plan bp left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
left join sme_org smec on (regexp_replace(bp.callcenter_of_sales  , '[^[:digit:]]', '') = smec.staff_no)
where bp.is_sales_partner in ('X - ລູກຄ້າໃໝ່ ທີ່ສົນໃຈເປັນນາຍໜ້າ', 'Y - ລູກຄ້າເກົ່າ ທີ່ສົນໃຈເປັນນາຍໜ້າ', 'Z - ລູກຄ້າປັດຈຸບັນ ທີ່ສົນໃຈເປັນນາຍໜ້າ')
	and bp.name not in (select refer_id from tabsme_Sales_partner where refer_type = 'tabSME_BO_and_Plan');
	

-- 1st method: to make your form can add new record after you import data from tabSME_BO_and_Plan
select max(name)+1 `next_not_cached_value` from tabsme_Sales_partner; 
alter table tabsme_Sales_partner auto_increment= 556395 ; -- next id
insert into sme_sales_partner_id_seq; select (select max(name)+1 `next_not_cached_value` from tabsme_Sales_partner), minimum_value, maximum_value, start_value, increment, cache_size, cycle_option, cycle_count 
from sme_bo_and_plan_id_seq;

-- 2nd method: 
-- Step 1: Get the next AUTO_INCREMENT value
SET @next_id = (SELECT MAX(id) + 1 FROM tabsme_Sales_partner);

-- Step 2: Construct the ALTER TABLE query
SET @query = CONCAT('ALTER TABLE tabsme_Sales_partner AUTO_INCREMENT=', @next_id);

-- Step 3: Prepare and execute the query
PREPARE stmt FROM @query;
EXECUTE stmt;
DEALLOCATE PREPARE stmt;

select now();
SHOW VARIABLES LIKE 'time_zone';
SHOW VARIABLES LIKE 'system_time_zone';


select * from tabsme_Sales_partner tsp order by name desc;

show events;
show variables like 'event_scheduler';



SELECT EVENT_NAME, STATUS, LAST_EXECUTED 
FROM information_schema.EVENTS 
WHERE EVENT_SCHEMA = '_8abac9eed59bf169';  -- Replace 'your_database_name' with the actual schema name












-- ---------------------------------- update sales partner type ----------------------------------
select refer_type, broker_type, count(*) from tabsme_Sales_partner group by refer_type, broker_type ;
update tabsme_Sales_partner set refer_type = '5way', broker_type = '5way - 5ສາຍພົວພັນ' where refer_type is null or refer_type = '5way';
update tabsme_Sales_partner set broker_type = 'X - ລູກຄ້າໃໝ່ ທີ່ສົນໃຈເປັນນາຍໜ້າ' where refer_type = 'tabSME_BO_and_Plan' and broker_type not in ('Y - ລູກຄ້າເກົ່າ ທີ່ສົນໃຈເປັນນາຍໜ້າ', 'Z - ລູກຄ້າປັດຈຸບັນ ທີ່ສົນໃຈເປັນນາຍໜ້າ'); 
select distinct refer_type, broker_type from tabsme_Sales_partner ;


select * from tabsme_Sales_partner where send_wa = '' or send_wa is null;
update tabsme_Sales_partner set send_wa = 'No-ສົ່ງບໍໄດ້' where send_wa = '' or send_wa is null;
update tabsme_Sales_partner set wa_date = date_format(modified, '%Y-%m-%d') where send_wa != '' and modified >= '2024-08-01' ;




-- ---------------------------------- delete deplicate -----------------------------------
delete from tabsme_Sales_partner where name in (

select refer_type, broker_type, count(*) from tabsme_Sales_partner where name in (
select `name` from ( 
		select `name`, row_number() over (partition by `broker_tel` order by field(`refer_type`, "LMS_Broker", "tabSME_BO_and_Plan", "5way"), 
			field(`broker_type`, "SP - ນາຍໜ້າໃນອາດີດ", "Y - ລູກຄ້າເກົ່າ ທີ່ສົນໃຈເປັນນາຍໜ້າ", "Z - ລູກຄ້າປັດຈຸບັນ ທີ່ສົນໃຈເປັນນາຍໜ້າ", "X - ລູກຄ້າໃໝ່ ທີ່ສົນໃຈເປັນນາຍໜ້າ", "5way - 5ສາຍພົວພັນ"), `name` asc) as row_numbers  
		from tabsme_Sales_partner
	) as t1
where row_numbers > 1 
) group by refer_type, broker_type ;

delete from tabsme_Sales_partner where name in (
select `name` from ( 
		select `name`, row_number() over (partition by `broker_tel` order by field(`refer_type`, "LMS_Broker", "tabSME_BO_and_Plan", "5way"), 
			field(`broker_type`, "SP - ນາຍໜ້າໃນອາດີດ", "Y - ລູກຄ້າເກົ່າ ທີ່ສົນໃຈເປັນນາຍໜ້າ", "Z - ລູກຄ້າປັດຈຸບັນ ທີ່ສົນໃຈເປັນນາຍໜ້າ", "X - ລູກຄ້າໃໝ່ ທີ່ສົນໃຈເປັນນາຍໜ້າ", "5way - 5ສາຍພົວພັນ"), `name` asc) as row_numbers  
		from tabsme_Sales_partner
	) as t1
where row_numbers > 1 
);



-- --------------------------------------------------------------------------------
select * from tabSME_BO_and_Plan tsbap order by name desc limit 10 -- name before import 219602

select name, customer_tel, custtbl_id from tabSME_BO_and_Plan tsbap where name >= 219602 and custtbl_id is not null

-- to make your form can add new record after you import data from tabSME_BO_and_Plan
select max(name)+1 `next_not_cached_value` from tabSME_BO_and_Plan;
alter table tabSME_BO_and_Plan auto_increment= 699110 ; -- next id
insert into sme_bo_and_plan_id_seq select (select max(name)+1 `next_not_cached_value` from tabSME_BO_and_Plan), minimum_value, maximum_value, start_value, increment, cache_size, cycle_option, cycle_count 
from sme_bo_and_plan_id_seq;


select * from tabsme_Sales_partner tsp where name in (292,293,294,295,858,859,860,861,862,863,864,865,866,867,868,869,870,871,872,873,874,908,947,948,1018,2163,2679,2735,2931,3100,3443,3811,3921,4258,4511,4740,5072,5126,5229,5545,96971)

update tabsme_Sales_partner set current_staff = '1453 - AON'
where name in (292,293,294,295,858,859,860,861,862,863,864,865,866,867,868,869,870,871,872,873,874,908,947,948,1018,2163,2679,2735,2931,3100,3443,3811,3921,4258,4511,4740,5072,5126,5229,5545,96971)

-- check
select bp.staff_no, tb.current_staff  from tabSME_BO_and_Plan bp inner join temp_sme_pbx_BO tb on (tb.id = bp.name)
where bp.staff_no != tb.current_staff;

-- update
update tabSME_BO_and_Plan bp inner join temp_sme_pbx_BO tb on (tb.id = bp.name)
set bp.staff_no = tb.current_staff where tb.`type` = 'F'; -- 369,654

update tabSME_BO_and_Plan bp inner join temp_sme_pbx_BO tb on (tb.id = bp.name)
set bp.staff_no = tb.current_staff where tb.`type` in ('S','A','B','C'); -- 52,928

update tabSME_BO_and_Plan bp inner join tabSME_BO_and_Plan_bk bpk on (bp.name = bpk.name)
set bp.staff_no = bpk.staff_no where bp.name in (select id from temp_sme_pbx_BO );

-- check
select * from temp_sme_pbx_SP ; -- 43,283

select sp.name, sp.current_staff, ts.current_staff from tabsme_Sales_partner sp inner join temp_sme_pbx_SP ts on (ts.id = sp.name)
where sp.current_staff != ts.current_staff ;

-- update 
update tabsme_Sales_partner sp inner join temp_sme_pbx_SP ts on (ts.id = sp.name)
set sp.current_staff = ts.current_staff;

-- export to check pbx SP
select sp.name `id`, sp.broker_tel, null `pbx_status`, null `date`, sp.current_staff
from tabsme_Sales_partner sp left join sme_org sme on (case when locate(' ', sp.current_staff) = 0 then sp.current_staff else left(sp.current_staff, locate(' ', sp.current_staff)-1) end = sme.staff_no)
inner join temp_sme_pbx_SP ts on (ts.id = sp.name)
where sp.refer_type = 'LMS_Broker' -- SP
	or (sp.refer_type = 'tabSME_BO_and_Plan' and sme.`unit_no` is not null) -- XYZ
	or (sp.refer_type = '5way' and sp.owner_staff = sp.current_staff and sme.`unit_no` is not null) -- 5way
order by sme.id ;



select *, left(sp.current_staff, locate(' ', sp.current_staff)-1) from tabsme_Sales_partner sp
where left(sp.current_staff, locate(' ', sp.current_staff)-1) in ('387', '')

select refer_id , business_type  from tabsme_Sales_partner sp where sp.refer_type = 'LMS_Broker'



insert into temp_sme_2
select name, custtbl_id, row_numbers, now() `time` from ( 
		select name, custtbl_id, row_number() over (partition by custtbl_id order by name) as row_numbers  
		from tabSME_BO_and_Plan 
		where name >= 219602 and custtbl_id is not null
		) as t1
	where row_numbers > 1; -- done <= 1068


select * from tabSME_BO_and_Plan where name in (select name from temp_sme_2 )

delete from tabSME_BO_and_Plan where name in (select name from temp_sme_2 )

-- 


select * from tabsme_Sales_partner_bk where name not in (select name from tabsme_Sales_partner);

select bp.name , bp.staff_no, te.staff_no, te.name from tabSME_BO_and_Plan bp left join tabsme_Employees te on (bp.staff_no = te.staff_no)
where bp.staff_no <> te.name and bp.name <= 10000;

update tabSME_BO_and_Plan bp left join tabsme_Employees te on (bp.staff_no = te.staff_no)
set bp.staff_no = te.name where bp.name in (72451, 72623, 75313, 77608) and bp.staff_no <> te.name ;


-- SABC export the current list 
update tabSME_BO_and_Plan bp inner join temp_sme_pbx_BO tb on (tb.id = bp.name)
set tb.current_staff = bp.staff_no where tb.`type` = 'F'

select * from temp_sme_pbx_BO tspb where `type` = 'F' and month_type <= 6; -- 30,292

select count(*)
from tabSME_BO_and_Plan bp left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
-- left join sme_org smec on (regexp_replace(bp.callcenter_of_sales  , '[^[:digit:]]', '') = smec.staff_no)
inner join temp_sme_pbx_BO tb on (tb.id = bp.name)
where bp.name in (select id from temp_sme_pbx_BO where `type` in ('F') and month_type <= 6)
order by sme.id asc;

-- SABC Additional list for SABC less or 1 year
select bp.name `id`, bp.customer_tel, null `pbx_status`, null `date`, staff_no `current_staff`, 
	case when bp.rank_update in ('S', 'A', 'B', 'C') then bp.rank_update else bp.rank1 end `type`, 
	case when timestampdiff(month, bp.creation, date(now())) > 36 then 36 else timestampdiff(month, bp.creation, date(now())) end `month_type`,
	case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' else bp.rank_update end `Now Result`
from tabSME_BO_and_Plan bp 
where ( (bp.rank1 in ('S', 'A', 'B', 'C') and date_format(bp.creation, '%Y-%m-%d') between '2024-01-01' and '2024-01-31' and bp.rank_update not in ('FFF') )
	or bp.rank_update in ('S', 'A', 'B', 'C') )
	and bp.contract_status not in ('Contracted', 'Cancelled');



-- __________________________________________ Prepare new Month __________________________________________
-- check and delete the customer who doesnn't like LALCO
select * from tabSME_BO_and_Plan where reason_of_credit = '18 ບໍ່ມັກ LALCO';
delete from tabSME_BO_and_Plan where reason_of_credit = '18 ບໍ່ມັກ LALCO';


-- SABC update the list for next month
delete from temp_sme_pbx_BO where type in ('S', 'A', 'B', 'C');

replace into temp_sme_pbx_BO
select bp.name `id`, bp.customer_tel, null `pbx_status`, null `date`, bp.staff_no `current_staff`, 
	case when bp.rank_update in ('S', 'A', 'B', 'C') then bp.rank_update else bp.rank1 end `type`, 
	case when timestampdiff(month, bp.creation, date(now())) > 36 then 36 else timestampdiff(month, bp.creation, date(now())) end `month_type`
	-- case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' else bp.rank_update end `Now Result`
from tabSME_BO_and_Plan bp 
where ( (bp.rank1 in ('S', 'A', 'B', 'C') and bp.rank_update not in ('FFF') )
	or bp.rank_update in ('S', 'A', 'B', 'C') )
	and bp.contract_status not in ('Contracted');


-- F update the list for next month
delete from temp_sme_pbx_BO where type in ('F');

insert into temp_sme_pbx_BO
select bp.name `id`, bp.customer_tel, null `pbx_status`, null `date`, bp.staff_no `current_staff`, 
	case when bp.rank_update in ('S', 'A', 'B', 'C') then bp.rank_update else 'F' end `type`, 
	case when timestampdiff(month, bp.creation, date(now())) > 36 then 36 else timestampdiff(month, bp.creation, date(now())) end `month_type`
	-- case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' else bp.rank_update end `Now Result`
from tabSME_BO_and_Plan bp 
where ( (bp.rank1 in ('F') and bp.rank_update not in ('FFF') )
	or bp.rank_update in ('F') )
	and bp.name not in (select id from temp_sme_pbx_BO where type in ('S', 'A', 'B', 'C') )
	and bp.contract_status not in ('Contracted');



-- SABC update
select bp.name `id`, bp.customer_tel, null `pbx_status`, null `date`, 
	case when bp.callcenter_of_sales is null or bp.callcenter_of_sales = '' then bp.staff_no else bp.callcenter_of_sales end `current_staff`,
	case when bp.rank_update in ('S', 'A', 'B', 'C') then bp.rank_update else bp.rank1 end `type`, 
	case when timestampdiff(month, bp.creation, date(now())) = 0  then 1
		when timestampdiff(month, bp.creation, date(now())) > 36 then 36 
		else timestampdiff(month, bp.creation, date(now())) 
	end `month_type`,
	case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' else bp.rank_update end `Now Result`,
	bp.address_province_and_city
from tabSME_BO_and_Plan bp left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
left join sme_org smec on (regexp_replace(bp.callcenter_of_sales  , '[^[:digit:]]', '') = smec.staff_no)
where ( bp.rank1 in ('S', 'A', 'B', 'C') or bp.rank_update in ('S', 'A', 'B', 'C') 
		or bp.name in (select id from temp_sme_pbx_BO where type in ('S', 'A', 'B', 'C') ) )
	and case when bp.contract_status = 'Contracted' then 'Contracted' when bp.contract_status = 'Cancelled' then 'Cancelled' else bp.rank_update end != 'Contracted'


select staff_no, name from tabsme_Employees ;
select * from temp_sme_pbx_BO where type in ('S', 'A', 'B', 'C');
delete from temp_sme_pbx_BO where type in ('S', 'A', 'B', 'C');

-- update
update tabSME_BO_and_Plan bp inner join temp_sme_pbx_BO tb on (tb.id = bp.name)
set bp.staff_no = tb.current_staff;



select sp.name, sp.current_staff, sp.owner_staff , te.name , te.staff_no 
from tabsme_Sales_partner sp left join tabsme_Employees te on (sp.owner_staff = te.staff_no) 
where sp.current_staff != te.name

update  tabsme_Sales_partner sp left join tabsme_Employees te on (sp.owner_staff = te.staff_no) 
set sp.owner_staff = te.name
where sp.owner_staff != te.name


-- Yoshi request
select bp.name `id`, date_format(bp.creation, '%Y-%m-%d') `date create`, bp.customer_name, bp.customer_tel , 
	case when timestampdiff(year, date_format(bp.creation, '%Y-%m-%d'), date(now())) =0 then 1 
	else timestampdiff(year, date_format(bp.creation, '%Y-%m-%d'), date(now())) end `year_type`, -- 
	case when tspb.id is not null then tspb.month_type else timestampdiff(month, date_format(bp.creation, '%Y-%m-%d'), date(now())) end `month_type`,
	bp.rank1, 
	case when bp.contract_status = 'Contracted' then 'Contracted' else bp.rank_update end `type`,
	case when bp.contract_status = 'Contracted' then 'x' else 'ok' end `without contracted`,
	case when sme.staff_no is not null then concat(sme.staff_no, ' - ', sme.staff_name)
		when smec.staff_no is not null then concat(smec.staff_no, ' - ', smec.staff_name)
		else null
	end 'current_staff'
from tabSME_BO_and_Plan bp left join temp_sme_pbx_BO tspb on (bp.name = tspb.id)
left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
left join sme_org smec on (regexp_replace(bp.callcenter_of_sales  , '[^[:digit:]]', '') = smec.staff_no)
where bp.rank1 in ('S', 'A', 'B', 'C', 'F') ;


select rank_update, COUNT(*) from tabSME_BO_and_Plan bp group by rank_update;

select address_province_and_city,
	count(case when contract_status = 'Contracted' then 1 end ) 'Contracted',
	count(case when contract_status != 'Contracted' and rank_update in ('S', 'A', 'B', 'C') then 1 end ) 'SABC',
	count(case when contract_status != 'Contracted' and rank_update in ('F', 'FF1', 'FF2', 'FFF') then 1 end ) 'F',
	count(case when contract_status != 'Contracted' and rank_update in ('G') then 1 end ) 'G'
from tabSME_BO_and_Plan bp group by address_province_and_city;

select address_province_and_city, contract_status, rank_update, count(*)
from tabSME_BO_and_Plan bp group by address_province_and_city, contract_status, rank_update;


-- prepare list for current 18 branches
select name 'id', customer_tel 'contact_no', customer_name 'name', 
	left(address_province_and_city, locate(' -', address_province_and_city)-1) 'province_eng', null 'province_laos',
	right(address_province_and_city, (length(address_province_and_city) - locate('- ', address_province_and_city) -1 ) ) 'district_eng', null 'district_laos',
	address_village 'village', 
	case when contract_status = 'Contracted' then 'Contracted'
		when contract_status != 'Contracted' and rank_update in ('S', 'A', 'B', 'C') then 'SABC'
		when contract_status != 'Contracted' and rank_update in ('F', 'FF1', 'FF2', 'FFF') then 'F'
		when contract_status != 'Contracted' and rank_update in ('G') then 'G'
	end 'type', 
	maker, model, `year`, rank_update 'remark_1', usd_loan_amount 'remark_2', null 'remark_3'
from tabSME_BO_and_Plan 
where contract_status != 'Contracted'
	and address_province_and_city in ('Sekong - La Mam')
order by address_province_and_city asc;





-- Users Email management  https://docs.google.com/spreadsheets/d/1y_aoS_10n_FAqgWbbaURD9D79WN--wgR5Ih3QwLWTag/edit#gid=659979462
select name, username, first_name, last_name , gender, birth_date, phone , mobile_no, enabled, time_zone from tabUser order by creation desc;


update tabUser set time_zone = 'Asia/Bangkok' where name != 'maheshprabuddika@gmail.com';
update tabUser set enabled = 0 where username in ('1186', '3851');

select * from tabUser where name = 'test1@lalco.la';
select * from user

select staff_no, main_contact  from tabsme_Employees te 

-- export HR system
select ha.name, date_format(ha.creation, '%Y-%m-%d') `date created`, date_format(ha.modified, '%Y-%m-%d') `date updated`,
	ha.office, ha.branch, ha.department, ha.head_of_department, ha.staff_no, 
	ha.category, ha.first_leave_date, ha.end_leave_date, ha.number_of_leave_day, 
	ha.reason, ha.detail_of_reason, concat('http://13.250.153.252:8000', replace(replace(ha.evidence, '/private', '' ), ' ', '%20' )) `evidence`,
	ha.workflow_state,
	concat('http://13.250.153.252:8000/app/hr_absence/', name) `Edit`
from tabHR_Absence ha ;




select address_province_and_city, count(*)
from tabSME_BO_and_Plan
where rank_update in ('G', 'G1', 'G2')
group by address_province_and_city 

select distinct address_province_and_city from tabSME_BO_and_Plan



-- select data to show in google sheet and looker studio
select cb.contract_no, sme.`g-dept`, sme.dept, sme.sec_branch, sme.unit, cb.sales_staff, cb.collection_staff, cb.collection_cc_staff,
	cb.customer_name, cb.debt_type, cb.collection_status, cb.now_amount_usd, ac.date, ac.collection_method, ac.call_result, ac.visited_result,
	ac.rank_of_case, ac.next_policy, ac.policy_due_date, ac.promise_date,
	concat('http://13.250.153.252:8000/app/activity_of_collection/', ac.name) `edit`,
	ac.priority,
	ac.collectioin_result, ac.is_order
from tabcontract_base cb 
left join sme_org sme on (case when locate(' ', cb.sales_staff) = 0 then cb.sales_staff else left(cb.sales_staff, locate(' ', cb.sales_staff)-1) end = sme.staff_no)
left join tabActivity_of_collection ac on ac.name = (select name from tabActivity_of_collection where contract_no = cb.name order by name desc limit 1)
where cb.debt_type != ''
order by sme.id asc;





select name, contract_no, `date`, gps_status, exceptional, collection_method, call_result, visited_result, promise_date, priority, is_order 
from tabActivity_of_collection


select contract_no, target_date, debt_type, collection_status from tabcontract_base


update tabcontract_base cb
left join tabActivity_of_collection ac2 on ac2.name = (select name from tabActivity_of_collection where contract_no = cb.name order by name desc limit 1)
set ac2.is_order = 1
where ac2.contract_no in (2106211,2106295,2102480,2103919,2103920,2106506,2076519,2105650,2074803,2077708,2082132,2104711,2104851,2105022,2078175,2082117,2062738,2085295,2089329,2104239,2104515,2105053,2105443,2104740,2105811,2105930,2106037,2098723,2100356,2101761,2073107,2100128,2100423,2102013,2105963,2106492,2103224,2102906,2100211,2102560,2102059,2102555,2104504,2106080,2103975,2103135,2099536,2101538,2103272,2103459,2103415,2104955,2103647,2103832,2106344,2105210,2102851,2097356,2103527,2105965,2102412,2105101
)




select now();
SELECT @@global.time_zone, @@session.time_zone;
SET time_zone = '+07:00';



-- 2) insert collection order to collection and collection CC people
insert into tabActivity_of_collection (`creation`, `contract_no`, `collection_staff`, `date`, `collection_method`, `collectioin_result`, `priority`)
select now() `creation`, cb.contract_no, cb.collection_staff, 
	case when cb.collection_status = 'already paid' then null else date(now()) end `date`, 
	case when cb.collection_status = 'already paid' then '' else 'Visit / ລົງຢ້ຽມຢາມ' end `collection_method`, 
	case when cb.collection_status = 'already paid' then 'Paid / ຈ່າຍ' else null end `collectioin_result`,
	case when cb.collection_status = 'already paid' then ''
		when count(ac.exceptional) >=1 then 1 -- Exceptional case
		when ac2.gps_status = 'offline' or cb.gps_status = 'offline' then 2 -- GPS Offline
		when count(ifnull(ac.promise_date, 1)) >= 1 then 3 -- No payment promise
		when count(ac.promise_date) or ac2.promise_date > date(now()) then 4 -- Break payment primise
		else 5 -- Others
	end `priority` 
from tabcontract_base cb left join tabActivity_of_collection ac on (ac.contract_no = cb.name)
left join tabActivity_of_collection ac2 on ac2.name = (select name from tabActivity_of_collection where contract_no = cb.name order by name desc limit 1)
 where cb.debt_type != '' and cb.collection_status = '0'
group by cb.name ;


delete from tabSME_BO_and_Plan_bk where name = 631221

select * from tabSME_BO_and_Plan bp where date_format(bp.creation, '%Y-%m-%d') = '2024-04-12' 

select ac.`date`, cb.contract_no, ac.exceptional, cb.gps_status 'base_gps_status', ac.gps_status 'activity_gps_status',  ac.promise_date
from tabcontract_base cb left join tabActivity_of_collection ac on (ac.contract_no = cb.name)


select * from tabActivity_of_collection where creation >= date(now()) -1  and contract_no in (2100087, 2106051)  ;

update tabActivity_of_collection set `date` = date(now()) where modified >= date(now())


-- Yoshi orders to check case that have car and no car
select rank_update, 
	count(case when maker != '' or model != '' then 1 end) 'Have car',
	count(case when maker is null and model is null then 1 end) 'No car'
from tabSME_BO_and_Plan 
-- where name <= 100
group by rank_update


select name, maker, model , case when maker != '' or model != '' then 'Have car' end `Car_check`, rank1 , rank_update 
from tabSME_BO_and_Plan where rank_update = 'F';


update tabSME_BO_and_Plan set rank1 = 'F', rank_update = 'F' where rank_update = ''


select *
from tabsme_Sales_partner sp
where current_staff = '387 - LEY' and refer_type = '5way' and sp.owner_staff = sp.current_staff




select name, creation, rank1, contract_status, disbursement_date_pay_date ,
	timestampdiff(day, date_format(creation, '%Y-%m-%d'), disbursement_date_pay_date)
from tabSME_BO_and_Plan bp
where rank1 in ('S', 'A', 'B', 'C')



select * from tabsme_Employees ;

update tabsme_Employees
	set main_contact = 
	  case when main_contact = '' then ''
		when (length (regexp_replace(main_contact , '[^[:digit:]]', '')) = 11 and left (regexp_replace(main_contact , '[^[:digit:]]', ''),3) = '020')
			or (length (regexp_replace(main_contact , '[^[:digit:]]', '')) = 10 and left (regexp_replace(main_contact , '[^[:digit:]]', ''),2) = '20')
			or (length (regexp_replace(main_contact , '[^[:digit:]]', '')) = 8 and left (regexp_replace(main_contact , '[^[:digit:]]', ''),1) in ('2','5','7','8','9'))
		then concat('20',right(regexp_replace(main_contact , '[^[:digit:]]', ''),8)) -- for 020
		when (length (regexp_replace(main_contact , '[^[:digit:]]', '')) = 10 and left (regexp_replace(main_contact , '[^[:digit:]]', ''),3) = '030')
			or (length (regexp_replace(main_contact , '[^[:digit:]]', '')) = 9 and left (regexp_replace(main_contact , '[^[:digit:]]', ''),2) = '30')
			or (length (regexp_replace(main_contact , '[^[:digit:]]', '')) = 7 and left (regexp_replace(main_contact , '[^[:digit:]]', ''),1) in ('2','4','5','7','9'))
		then concat('30',right(regexp_replace(main_contact , '[^[:digit:]]', ''),7)) -- for 030
		when left (right (regexp_replace(main_contact , '[^[:digit:]]', ''),8),1) in ('0','1','') then concat('30',right(regexp_replace(main_contact , '[^[:digit:]]', ''),7))
		when left (right (regexp_replace(main_contact , '[^[:digit:]]', ''),8),1) in ('2','5','7','8','9')
		then concat('20',right(regexp_replace(main_contact , '[^[:digit:]]', ''),8))
		else concat('20',right(regexp_replace(main_contact , '[^[:digit:]]', ''),8))
	end
;






--  check where the cases we executed today and yesterday came from? Is it from everyday prospect customers
select name 'id', customer_name, customer_tel, creation, modified, rank1, rank_update, contract_status, staff_no, callcenter_of_sales,
	left(bp.staff_no, locate(' -', bp.staff_no)-1) 'Sales_no', left(bp.callcenter_of_sales, locate(' -', bp.callcenter_of_sales)-1) 'CC_no'
from tabSME_BO_and_Plan bp
where customer_tel in ('902099122133')
order by name desc;





select approach_id from sme_new_branch where approach_type = 'SABC'


select * from tabSME_Approach_list limit 10


insert into tabSME_Approach_list
(`creation`, `modified`, `modified_by`, `owner`, `docstatus`, `idx`, `staff_no`, `callcenter_of_sales`, `double_count`, `type`, `is_sales_partner`, `approch_list`, `visit_or_not`, `reason_of_visit`, `visit_date`, `details_of_visit_reason`, `priority_to_visit`, `visit_location_url`, `visit_time`, `evidence`, `disbursement_date_pay_date`, `usd_loan_amount`, `usd_fee_amount`, `monthly_interest_rate`, `normal_bullet`, `contract_no`, `case_no`, `customer_name`, `customer_tel`, `address_province_and_city`, `address_village`, `rank1`, `rank_update`, `customer_card`, `attach_customer_card`, `ringi_status`, `ringi_comment`, `contract_status`, `contract_comment`, `maker`, `model`, `year`, `usd_value`, `estate_types`, `land_area`, `real_estate_province_and_city`, `village`, `owner_first_name`, `owner_last_name`, `who_is_it`, `usd_value_of_real_estate`, `have_or_not`, `from_whom`, `date`, `usd_value_of_receivable`, `remark`, `sp_cc`, `rank_update_sp_cc`, `sp_cc_remark`, `credit`, `rank_of_credit`, `reason_of_credit`, `credit_remark`, `visit_checker`, `actual_visit_or_not`, `comment_by_visit_checker`, `_user_tags`, `_comments`, `_assign`, `_liked_by`, `priority`, `branch_name`, `approach_type`, `approach_id`
)
;select `creation`, `modified`, `modified_by`, `owner`, `docstatus`, `idx`, `staff_no`, `callcenter_of_sales`, `double_count`, `type`, 
	`is_sales_partner`, `approch_list`, `visit_or_not`, `reason_of_visit`, `visit_date`, `details_of_visit_reason`, `priority_to_visit`, 
	`visit_location_url`, `visit_time`, `evidence`, `disbursement_date_pay_date`, `usd_loan_amount`, `usd_fee_amount`, `monthly_interest_rate`, 
	`normal_bullet`, `contract_no`, `case_no`, `customer_name`, `customer_tel`, `address_province_and_city`, `address_village`, `rank1`, `rank_update`, 
	`customer_card`, `attach_customer_card`, `ringi_status`, `ringi_comment`, `contract_status`, `contract_comment`, `maker`, `model`, `year`, 
	`usd_value`, `estate_types`, `land_area`, `real_estate_province_and_city`, `village`, `owner_first_name`, `owner_last_name`, `who_is_it`, 
	`usd_value_of_real_estate`, `have_or_not`, `from_whom`, `date`, `usd_value_of_receivable`, `remark`, `sp_cc`, `rank_update_sp_cc`, `sp_cc_remark`, 
	`credit`, `rank_of_credit`, `reason_of_credit`, `credit_remark`, `visit_checker`, `actual_visit_or_not`, `comment_by_visit_checker`, `_user_tags`, 
	`_comments`, `_assign`, `_liked_by`, null `priority`, nb.`branch_name`, nb.`approach_type`, nb.approach_id 
from tabSME_BO_and_Plan bp inner join sme_new_branch nb on (bp.name = nb.approach_id)



select * from tabSME_Approach_list tsbap limit 10

select count(*) from tabSME_Approach_list where approach_type = 'Approach list'


-- SME_now_SABC
select bp.*
from tabSME_Approach_list bp left join sme_org sme on (case when locate(' ', bp.staff_no) = 0 then bp.staff_no else left(bp.staff_no, locate(' ', bp.staff_no)-1) end = sme.staff_no)
left join sme_org smec on (regexp_replace(bp.callcenter_of_sales  , '[^[:digit:]]', '') = smec.staff_no)
where bp.approach_id in (select approach_id from sme_new_branch where approach_type = 'SABC')
order by case when bp.callcenter_of_sales is null or bp.callcenter_of_sales = '' then sme.id else smec.id end asc;


























-- _______________________________________________







